# æ— äººæœºæ§åˆ¶ç³»ç»Ÿäº‘éƒ¨ç½²æ–¹æ¡ˆ

## ğŸ“Š ç³»ç»Ÿæ¶æ„åˆ†æ

### å½“å‰ç³»ç»Ÿç»„æˆ

```
drone-web-control/
â”œâ”€â”€ åç«¯æœåŠ¡ (Node.js + Express)
â”‚   â”œâ”€â”€ HTTP API (ç«¯å£3000)
â”‚   â”œâ”€â”€ WebSocketæœåŠ¡å™¨ (ç«¯å£3000)
â”‚   â”œâ”€â”€ MQTTå®¢æˆ·ç«¯ (è¿æ¥mosquitto:1883)
â”‚   â””â”€â”€ æ¢ç´¢å¼•æ“ (å†…å­˜è®¡ç®—)
â”‚
â”œâ”€â”€ å‰ç«¯åº”ç”¨ (React)
â”‚   â”œâ”€â”€ 3Då¯è§†åŒ– (Three.js)
â”‚   â”œâ”€â”€ ç‚¹äº‘æ¸²æŸ“
â”‚   â””â”€â”€ æ§åˆ¶ç•Œé¢ (Ant Design)
â”‚
â””â”€â”€ MQTT Broker (Mosquitto)
    â”œâ”€â”€ æ¥æ”¶æ— äººæœºæ•°æ®
    â””â”€â”€ ä¸‹å‘æ§åˆ¶æŒ‡ä»¤
```

### ç³»ç»Ÿèµ„æºéœ€æ±‚åˆ†æ

| ç»„ä»¶ | CPU | å†…å­˜ | å­˜å‚¨ | ç½‘ç»œå¸¦å®½ |
|------|-----|------|------|---------|
| åç«¯æœåŠ¡ | 1-2æ ¸ | 512MB-1GB | 5GB | 5-10Mbps |
| å‰ç«¯æ„å»º | 2æ ¸ | 2GB | 10GB | - |
| MQTT Broker | 0.5æ ¸ | 256MB | 1GB | 1-5Mbps |
| æ•°æ®åº“(å¯é€‰) | 1æ ¸ | 512MB | 20GB | - |

---

## â˜ï¸ æ¨èäº‘æœåŠ¡æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šé˜¿é‡Œäº‘ï¼ˆæ¨èå›½å†…ç”¨æˆ·ï¼‰

#### é…ç½®æ¨è

**1. è½»é‡åº”ç”¨æœåŠ¡å™¨ï¼ˆå…¥é—¨çº§ï¼‰**
- **è§„æ ¼**: 2æ ¸2GB
- **å¸¦å®½**: 5Mbps
- **å­˜å‚¨**: 40GB SSD
- **ä»·æ ¼**: ~Â¥70-100/æœˆ
- **é€‚ç”¨**: å¼€å‘æµ‹è¯•ã€å°è§„æ¨¡ä½¿ç”¨

**2. ECSäº‘æœåŠ¡å™¨ï¼ˆç”Ÿäº§çº§ï¼‰**
- **è§„æ ¼**: 2æ ¸4GB
- **å¸¦å®½**: 10Mbps
- **å­˜å‚¨**: 60GB SSD
- **ä»·æ ¼**: ~Â¥150-200/æœˆ
- **é€‚ç”¨**: ç”Ÿäº§ç¯å¢ƒã€å¤šç”¨æˆ·

**3. æ¨èå®ä¾‹ç±»å‹**
- **é€šç”¨å‹ g6**: é€‚åˆå‡è¡¡è´Ÿè½½
- **è®¡ç®—å‹ c6**: å¦‚æœæ¢ç´¢å¼•æ“è®¡ç®—å¯†é›†

#### ç½‘ç»œé…ç½®
- **å†…ç½‘IP**: è‡ªåŠ¨åˆ†é…
- **å…¬ç½‘IP**: å›ºå®šIPæˆ–EIP
- **å®‰å…¨ç»„è§„åˆ™**:
  ```
  å…¥æ–¹å‘:
  - 3000 (HTTP/WebSocket)
  - 5000 (å‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼Œå¯é€‰)
  - 1883 (MQTTï¼Œä»…æ— äººæœºIP)
  - 22 (SSHç®¡ç†)

  å‡ºæ–¹å‘:
  - å…¨éƒ¨å…è®¸
  ```

---

### æ–¹æ¡ˆ2ï¼šè…¾è®¯äº‘

#### é…ç½®æ¨è

**1. è½»é‡åº”ç”¨æœåŠ¡å™¨**
- **è§„æ ¼**: 2æ ¸2GB
- **å¸¦å®½**: 6Mbps
- **å­˜å‚¨**: 50GB SSD
- **ä»·æ ¼**: ~Â¥68-88/æœˆ

**2. äº‘æœåŠ¡å™¨CVM**
- **è§„æ ¼**: 2æ ¸4GB
- **å¸¦å®½**: 10Mbps
- **å­˜å‚¨**: 60GB äº‘ç¡¬ç›˜
- **ä»·æ ¼**: ~Â¥140-180/æœˆ

#### ç‰¹è‰²åŠŸèƒ½
- **Lighthouse**: ä¸€é”®éƒ¨ç½²åº”ç”¨
- **CLBè´Ÿè½½å‡è¡¡**: å¤šæ— äººæœºé«˜å¹¶å‘
- **CDNåŠ é€Ÿ**: å‰ç«¯é™æ€èµ„æºåŠ é€Ÿ

---

### æ–¹æ¡ˆ3ï¼šåä¸ºäº‘

#### é…ç½®æ¨è

**1. å¼¹æ€§äº‘æœåŠ¡å™¨ECS**
- **è§„æ ¼**: é€šç”¨è®¡ç®—å¢å¼ºå‹ c6.large.2
- **é…ç½®**: 2æ ¸4GB
- **å¸¦å®½**: 10Mbps
- **ä»·æ ¼**: ~Â¥150-180/æœˆ

#### ä¼˜åŠ¿
- **CCEå®¹å™¨å¼•æ“**: æ”¯æŒDocker/K8séƒ¨ç½²
- **APIç½‘å…³**: ç»Ÿä¸€APIç®¡ç†
- **IoTå¹³å°**: å¯å¯¹æ¥åä¸ºIoTè®¾å¤‡ç®¡ç†

---

### æ–¹æ¡ˆ4ï¼šAWSä¸­å›½ï¼ˆæµ·å¤–ç”¨æˆ·å¯é€‰å›½é™…ç‰ˆï¼‰

#### é…ç½®æ¨è

**1. EC2å®ä¾‹**
- **å®ä¾‹ç±»å‹**: t3.small
- **é…ç½®**: 2æ ¸2GB
- **å¸¦å®½**: æŒ‰æµé‡è®¡è´¹
- **ä»·æ ¼**: ~$20-30/æœˆ (Â¥140-210/æœˆ)

**2. Lightsailï¼ˆç®€åŒ–ç‰ˆï¼‰**
- **é…ç½®**: 1GBå†…å­˜æ–¹æ¡ˆ
- **ä»·æ ¼**: $5/æœˆ (Â¥35/æœˆ)
- **é€‚ç”¨**: å°è§„æ¨¡æµ‹è¯•

#### AWSç‰¹è‰²
- **å¼¹æ€§ä¼¸ç¼©**: è‡ªåŠ¨æ‰©å±•èµ„æº
- **IoT Core**: ä¸“ä¸šç‰©è”ç½‘æœåŠ¡
- **CloudWatch**: å®Œå–„ç›‘æ§

---

## ğŸ¯ ç»¼åˆæ¨èï¼ˆåŸºäºä½ çš„ç³»ç»Ÿï¼‰

### æœ€ä½³æ–¹æ¡ˆï¼šé˜¿é‡Œäº‘è½»é‡åº”ç”¨æœåŠ¡å™¨

**ç†ç”±**ï¼š
1. âœ… **æ€§ä»·æ¯”é«˜** - 2æ ¸2GBçº¦Â¥70/æœˆ
2. âœ… **å›½å†…è®¿é—®å¿«** - ä½å»¶è¿Ÿ
3. âœ… **ç®€å•æ˜“ç”¨** - æ§åˆ¶å°å‹å¥½
4. âœ… **é›†æˆåº¦é«˜** - ä¸€é”®ç¯å¢ƒé…ç½®

**æ¨èé…ç½®**ï¼š
```yaml
äº‘æœåŠ¡å•†: é˜¿é‡Œäº‘
æœåŠ¡ç±»å‹: è½»é‡åº”ç”¨æœåŠ¡å™¨
è§„æ ¼: 2æ ¸ 2GB 5Mbps
ç³»ç»Ÿ: Ubuntu 22.04 LTS
å­˜å‚¨: 40GB SSD
åœ°åŸŸ: è·ç¦»ä½ ç‰©ç†ä½ç½®æœ€è¿‘çš„åŒºåŸŸ
  - åä¸œ(æ­å·/ä¸Šæµ·)
  - ååŒ—(åŒ—äº¬)
  - åå—(å¹¿å·/æ·±åœ³)
```

**æœˆåº¦è´¹ç”¨é¢„ä¼°**ï¼š
- æœåŠ¡å™¨ï¼šÂ¥70-100
- æµé‡è´¹ï¼šÂ¥0-20ï¼ˆæŒ‰éœ€ï¼‰
- åŸŸåï¼ˆå¯é€‰ï¼‰ï¼šÂ¥50-100/å¹´
- **æ€»è®¡**: ~Â¥80-120/æœˆ

---

## ğŸ“¦ éƒ¨ç½²æ¶æ„æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šå•æœºéƒ¨ç½²ï¼ˆæ¨èå…¥é—¨ï¼‰

```
[é˜¿é‡Œäº‘ECS 2æ ¸2GB]
â”œâ”€â”€ Nginx (åå‘ä»£ç† + é™æ€æ–‡ä»¶)
â”‚   â”œâ”€â”€ :80 â†’ å‰ç«¯é™æ€æ–‡ä»¶
â”‚   â””â”€â”€ :80/api â†’ :3000 åç«¯API
â”‚
â”œâ”€â”€ Node.jsåç«¯ (:3000)
â”‚   â”œâ”€â”€ Express HTTP API
â”‚   â”œâ”€â”€ WebSocketæœåŠ¡
â”‚   â””â”€â”€ æ¢ç´¢å¼•æ“
â”‚
â””â”€â”€ Mosquitto MQTT (:1883)
    â””â”€â”€ æ¥æ”¶æ— äººæœºæ•°æ®

[æœ¬åœ°æ— äººæœº]
â””â”€â”€ MQTTè¿æ¥åˆ° äº‘æœåŠ¡å™¨å…¬ç½‘IP:1883
```

**ä¼˜ç‚¹**ï¼š
- ç®€å•æ˜“éƒ¨ç½²
- æˆæœ¬æœ€ä½
- é€‚åˆ1-5å°æ— äººæœº

**ç¼ºç‚¹**ï¼š
- å•ç‚¹æ•…éšœ
- æ‰©å±•æ€§æœ‰é™

---

### æ–¹æ¡ˆBï¼šå‰åç«¯åˆ†ç¦»ï¼ˆæ¨èç”Ÿäº§ï¼‰

```
[é˜¿é‡Œäº‘OSSå¯¹è±¡å­˜å‚¨]
â””â”€â”€ å‰ç«¯é™æ€æ–‡ä»¶ (Reactæ„å»ºäº§ç‰©)
    â””â”€â”€ ç»‘å®šCDNåŠ é€Ÿ

[é˜¿é‡Œäº‘ECS 2æ ¸4GB]
â”œâ”€â”€ Node.jsåç«¯ (:3000)
â”‚   â”œâ”€â”€ HTTP API
â”‚   â”œâ”€â”€ WebSocket
â”‚   â””â”€â”€ æ¢ç´¢å¼•æ“
â”‚
â””â”€â”€ Mosquitto MQTT (:1883)

[æœ¬åœ°æ— äººæœº]
â””â”€â”€ MQTTè¿æ¥åˆ° ECSå…¬ç½‘IP:1883
```

**ä¼˜ç‚¹**ï¼š
- å‰ç«¯åŠ è½½å¿«ï¼ˆCDNï¼‰
- åç«¯æ€§èƒ½æ›´å¥½
- é€‚åˆ10+ç”¨æˆ·

**ç¼ºç‚¹**ï¼š
- é…ç½®ç¨å¤æ‚
- æˆæœ¬ç•¥é«˜ï¼ˆ+OSSè´¹ç”¨ï¼‰

---

### æ–¹æ¡ˆCï¼šå®¹å™¨åŒ–éƒ¨ç½²ï¼ˆé«˜çº§ï¼‰

```
[é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡ACK]
â”œâ”€â”€ Frontend Pod (Nginx + React)
â”‚   â””â”€â”€ LoadBalancer :80
â”‚
â”œâ”€â”€ Backend Pod (Node.js)
â”‚   â””â”€â”€ ClusterIP :3000
â”‚
â””â”€â”€ MQTT Pod (Mosquitto)
    â””â”€â”€ LoadBalancer :1883

è‡ªåŠ¨ä¼¸ç¼©ã€æ»šåŠ¨æ›´æ–°ã€å¥åº·æ£€æŸ¥
```

**ä¼˜ç‚¹**ï¼š
- é«˜å¯ç”¨
- è‡ªåŠ¨æ‰©å±•
- æ˜“äºç»´æŠ¤

**ç¼ºç‚¹**ï¼š
- æˆæœ¬è¾ƒé«˜ï¼ˆÂ¥300+/æœˆï¼‰
- éœ€è¦K8sçŸ¥è¯†

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤ï¼ˆæ–¹æ¡ˆA - å•æœºéƒ¨ç½²ï¼‰

### ç¬¬1æ­¥ï¼šè´­ä¹°æœåŠ¡å™¨

1. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
2. é€‰æ‹©"è½»é‡åº”ç”¨æœåŠ¡å™¨"
3. é…ç½®é€‰æ‹©ï¼š
   - åœ°åŸŸï¼šå°±è¿‘é€‰æ‹©
   - é•œåƒï¼šUbuntu 22.04
   - å¥—é¤ï¼š2æ ¸2GB 5Mbps
   - è´­ä¹°æ—¶é•¿ï¼šæŒ‰éœ€ï¼ˆæœˆä»˜/å¹´ä»˜ï¼‰

### ç¬¬2æ­¥ï¼šé…ç½®å®‰å…¨ç»„

åœ¨æ§åˆ¶å° â†’ é˜²ç«å¢™è®¾ç½®ï¼š

```
è§„åˆ™åç§°     åè®®   ç«¯å£    ç­–ç•¥   æ¥æº
----------------------------------------------
Webè®¿é—®      TCP    80      å…è®¸   0.0.0.0/0
HTTPSè®¿é—®    TCP    443     å…è®¸   0.0.0.0/0
åç«¯API      TCP    3000    å…è®¸   0.0.0.0/0
MQTTæœåŠ¡     TCP    1883    å…è®¸   æ— äººæœºIP/0.0.0.0/0
SSHç®¡ç†      TCP    22      å…è®¸   ä½ çš„IP
```

âš ï¸ **å®‰å…¨å»ºè®®**ï¼š
- MQTTç«¯å£1883åªå¼€æ”¾ç»™æ— äººæœºIPæ®µ
- æˆ–ä½¿ç”¨MQTTç”¨æˆ·åå¯†ç è®¤è¯

### ç¬¬3æ­¥ï¼šè¿æ¥æœåŠ¡å™¨

```bash
# ä½¿ç”¨SSHè¿æ¥ï¼ˆæ›¿æ¢ä¸ºä½ çš„æœåŠ¡å™¨IPï¼‰
ssh root@ä½ çš„æœåŠ¡å™¨IP

# é¦–æ¬¡ç™»å½•å»ºè®®ä¿®æ”¹å¯†ç 
passwd
```

### ç¬¬4æ­¥ï¼šå®‰è£…åŸºç¡€ç¯å¢ƒ

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…Node.js 18.x
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# éªŒè¯å®‰è£…
node --version  # åº”æ˜¾ç¤º v18.x.x
npm --version

# å®‰è£…Mosquitto MQTT Broker
sudo apt install -y mosquitto mosquitto-clients

# å¯åŠ¨Mosquitto
sudo systemctl start mosquitto
sudo systemctl enable mosquitto

# å®‰è£…Nginx
sudo apt install -y nginx

# å®‰è£…Git
sudo apt install -y git

# å®‰è£…PM2ï¼ˆè¿›ç¨‹ç®¡ç†ï¼‰
sudo npm install -g pm2
```

### ç¬¬5æ­¥ï¼šä¸Šä¼ ä»£ç 

**æ–¹æ³•1ï¼šGitå…‹éš†ï¼ˆæ¨èï¼‰**

```bash
# å¦‚æœä»£ç å·²æ‰˜ç®¡åˆ°GitHub/Gitee
cd /home
git clone https://github.com/ä½ çš„ç”¨æˆ·å/drone-web-control.git
cd drone-web-control
```

**æ–¹æ³•2ï¼šæ‰‹åŠ¨ä¸Šä¼ **

```bash
# æœ¬åœ°æ‰“åŒ…
cd c:\Users\23054\Desktop\å®¤å†…æ— äººæœº\drone-web-control
tar -czf drone-web-control.tar.gz --exclude=node_modules .

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp drone-web-control.tar.gz root@æœåŠ¡å™¨IP:/home/

# æœåŠ¡å™¨è§£å‹
cd /home
tar -xzf drone-web-control.tar.gz
mv drone-web-control drone-web-control
```

### ç¬¬6æ­¥ï¼šå®‰è£…ä¾èµ–

```bash
cd /home/drone-web-control

# å®‰è£…åç«¯ä¾èµ–
npm install

# å®‰è£…å‰ç«¯ä¾èµ–
cd client
npm install
cd ..
```

### ç¬¬7æ­¥ï¼šé…ç½®MQTT

ç¼–è¾‘Mosquittoé…ç½®ï¼š

```bash
sudo nano /etc/mosquitto/mosquitto.conf
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```conf
# å…è®¸åŒ¿åè¿æ¥ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®é…ç½®ç”¨æˆ·åå¯†ç ï¼‰
allow_anonymous true

# ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£
listener 1883 0.0.0.0

# æ—¥å¿—
log_dest file /var/log/mosquitto/mosquitto.log
log_type all
```

é‡å¯Mosquittoï¼š

```bash
sudo systemctl restart mosquitto
```

**é…ç½®ç”¨æˆ·åå¯†ç ï¼ˆæ¨èï¼‰**ï¼š

```bash
# åˆ›å»ºå¯†ç æ–‡ä»¶
sudo mosquitto_passwd -c /etc/mosquitto/passwd drone_user

# ç¼–è¾‘é…ç½®
sudo nano /etc/mosquitto/mosquitto.conf

# ä¿®æ”¹ä¸ºï¼š
allow_anonymous false
password_file /etc/mosquitto/passwd

# é‡å¯
sudo systemctl restart mosquitto
```

### ç¬¬8æ­¥ï¼šæ„å»ºå‰ç«¯

```bash
cd /home/drone-web-control/client

# ä¿®æ”¹APIåœ°å€ä¸ºäº‘æœåŠ¡å™¨åœ°å€
nano src/services/websocket.js
# å°† localhost æ”¹ä¸ºä½ çš„æœåŠ¡å™¨IPæˆ–åŸŸå

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# æ„å»ºäº§ç‰©åœ¨ client/build ç›®å½•
```

### ç¬¬9æ­¥ï¼šé…ç½®Nginx

åˆ›å»ºNginxé…ç½®æ–‡ä»¶ï¼š

```bash
sudo nano /etc/nginx/sites-available/drone-control
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```nginx
server {
    listen 80;
    server_name ä½ çš„åŸŸåæˆ–IP;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /home/drone-web-control/client/build;
        try_files $uri $uri/ /index.html;
    }

    # åç«¯APIä»£ç†
    location /api {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # WebSocketä»£ç†
    location /ws {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $host;
    }
}
```

å¯ç”¨é…ç½®ï¼š

```bash
sudo ln -s /etc/nginx/sites-available/drone-control /etc/nginx/sites-enabled/
sudo nginx -t  # æµ‹è¯•é…ç½®
sudo systemctl restart nginx
```

### ç¬¬10æ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡

ä½¿ç”¨PM2ç®¡ç†è¿›ç¨‹ï¼š

```bash
cd /home/drone-web-control

# å¯åŠ¨åç«¯
pm2 start server/index.js --name drone-backend

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save

# æŸ¥çœ‹æ—¥å¿—
pm2 logs drone-backend

# æŸ¥çœ‹çŠ¶æ€
pm2 status
```

### ç¬¬11æ­¥ï¼šé…ç½®æ— äººæœºè¿æ¥

ä¿®æ”¹æ— äººæœºMQTTé…ç½®ï¼Œè¿æ¥åˆ°äº‘æœåŠ¡å™¨ï¼š

```javascript
// æ— äººæœºç«¯é…ç½®
const MQTT_BROKER = "mqtt://ä½ çš„æœåŠ¡å™¨å…¬ç½‘IP:1883";

// å¦‚æœé…ç½®äº†ç”¨æˆ·åå¯†ç 
const MQTT_OPTIONS = {
  username: "drone_user",
  password: "ä½ çš„å¯†ç "
};
```

### ç¬¬12æ­¥ï¼šæµ‹è¯•è®¿é—®

1. **å‰ç«¯è®¿é—®**: http://ä½ çš„æœåŠ¡å™¨IP
2. **APIæµ‹è¯•**: http://ä½ çš„æœåŠ¡å™¨IP/api/status
3. **MQTTæµ‹è¯•**:
   ```bash
   mosquitto_pub -h ä½ çš„æœåŠ¡å™¨IP -t "/test" -m "hello"
   mosquitto_sub -h ä½ çš„æœåŠ¡å™¨IP -t "/test"
   ```

---

## ğŸ”’ å®‰å…¨åŠ å›º

### 1. é…ç½®HTTPSï¼ˆLet's Encryptå…è´¹è¯ä¹¦ï¼‰

```bash
# å®‰è£…Certbot
sudo apt install -y certbot python3-certbot-nginx

# è·å–è¯ä¹¦ï¼ˆéœ€è¦åŸŸåï¼‰
sudo certbot --nginx -d ä½ çš„åŸŸå.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

### 2. é…ç½®é˜²ç«å¢™

```bash
# å¯ç”¨UFWé˜²ç«å¢™
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 1883/tcp
sudo ufw enable
```

### 3. MQTTå®‰å…¨é…ç½®

```bash
# é…ç½®TLSåŠ å¯†ï¼ˆå¯é€‰ï¼‰
sudo nano /etc/mosquitto/mosquitto.conf

# æ·»åŠ ï¼š
listener 8883
cafile /etc/mosquitto/certs/ca.crt
certfile /etc/mosquitto/certs/server.crt
keyfile /etc/mosquitto/certs/server.key
```

### 4. å®šæœŸå¤‡ä»½

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
nano /home/backup.sh

#!/bin/bash
DATE=$(date +%Y%m%d)
tar -czf /home/backup-$DATE.tar.gz /home/drone-web-control
# ä¸Šä¼ åˆ°OSSæˆ–å…¶ä»–å­˜å‚¨

# æ·»åŠ å®šæ—¶ä»»åŠ¡
crontab -e
# æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /home/backup.sh
```

---

## ğŸ“ˆ ç›‘æ§å’Œæ—¥å¿—

### 1. PM2ç›‘æ§

```bash
# å®æ—¶ç›‘æ§
pm2 monit

# æŸ¥çœ‹èµ„æºå ç”¨
pm2 status

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 show drone-backend
```

### 2. æ—¥å¿—ç®¡ç†

```bash
# PM2æ—¥å¿—
pm2 logs drone-backend

# Nginxæ—¥å¿—
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# Mosquittoæ—¥å¿—
tail -f /var/log/mosquitto/mosquitto.log

# ç³»ç»Ÿèµ„æºç›‘æ§
htop
```

### 3. é…ç½®é˜¿é‡Œäº‘ç›‘æ§

åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°ï¼š
- äº‘ç›‘æ§ â†’ ä¸»æœºç›‘æ§
- é…ç½®å‘Šè­¦è§„åˆ™ï¼š
  - CPUä½¿ç”¨ç‡ > 80%
  - å†…å­˜ä½¿ç”¨ç‡ > 85%
  - ç£ç›˜ä½¿ç”¨ç‡ > 90%

---

## ğŸ’° æˆæœ¬ä¼°ç®—

### æœ€å°åŒ–é…ç½®ï¼ˆå¼€å‘æµ‹è¯•ï¼‰

| é¡¹ç›® | è´¹ç”¨ |
|------|------|
| é˜¿é‡Œäº‘è½»é‡æœåŠ¡å™¨ 2æ ¸2GB | Â¥70/æœˆ |
| æµé‡è´¹ï¼ˆ100GBå†…ï¼‰ | Â¥0 |
| åŸŸåï¼ˆå¯é€‰ï¼‰ | Â¥50/å¹´ |
| **æœˆåº¦æ€»è®¡** | **Â¥70** |

### ç”Ÿäº§ç¯å¢ƒé…ç½®

| é¡¹ç›® | è´¹ç”¨ |
|------|------|
| é˜¿é‡Œäº‘ECS 2æ ¸4GB | Â¥150/æœˆ |
| OSSå­˜å‚¨ï¼ˆå‰ç«¯é™æ€æ–‡ä»¶ï¼‰ | Â¥10/æœˆ |
| CDNæµé‡ï¼ˆå¯é€‰ï¼‰ | Â¥20/æœˆ |
| åŸŸå + SSLè¯ä¹¦ | Â¥100/å¹´ |
| **æœˆåº¦æ€»è®¡** | **Â¥180-200** |

---

## ğŸ”„ CI/CDè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰

### ä½¿ç”¨GitHub Actions

åˆ›å»º `.github/workflows/deploy.yml`ï¼š

```yaml
name: Deploy to Aliyun

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'

      - name: Install dependencies
        run: |
          npm install
          cd client && npm install

      - name: Build frontend
        run: cd client && npm run build

      - name: Deploy to server
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_SSH_KEY }}
          source: "."
          target: "/home/drone-web-control"

      - name: Restart PM2
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_SSH_KEY }}
          script: |
            cd /home/drone-web-control
            pm2 restart drone-backend
```

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨æ¸…å•

### ç«‹å³è¡ŒåŠ¨

- [ ] 1. é€‰æ‹©äº‘æœåŠ¡å•†å’Œå¥—é¤
- [ ] 2. è´­ä¹°æœåŠ¡å™¨ï¼ˆå»ºè®®æœˆä»˜å…ˆæµ‹è¯•ï¼‰
- [ ] 3. é…ç½®å®‰å…¨ç»„è§„åˆ™
- [ ] 4. SSHè¿æ¥æœåŠ¡å™¨
- [ ] 5. å®‰è£…åŸºç¡€ç¯å¢ƒï¼ˆNode.jsã€Nginxã€Mosquittoï¼‰

### éƒ¨ç½²é˜¶æ®µ

- [ ] 6. ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨
- [ ] 7. å®‰è£…ä¾èµ–
- [ ] 8. é…ç½®MQTT Broker
- [ ] 9. æ„å»ºå‰ç«¯é¡¹ç›®
- [ ] 10. é…ç½®Nginxåå‘ä»£ç†

### å¯åŠ¨é˜¶æ®µ

- [ ] 11. ä½¿ç”¨PM2å¯åŠ¨åç«¯
- [ ] 12. æµ‹è¯•å‰ç«¯è®¿é—®
- [ ] 13. é…ç½®æ— äººæœºè¿æ¥äº‘æœåŠ¡å™¨
- [ ] 14. åŠŸèƒ½æµ‹è¯•

### ä¼˜åŒ–é˜¶æ®µ

- [ ] 15. é…ç½®HTTPSè¯ä¹¦
- [ ] 16. é…ç½®MQTTç”¨æˆ·è®¤è¯
- [ ] 17. è®¾ç½®ç›‘æ§å‘Šè­¦
- [ ] 18. é…ç½®è‡ªåŠ¨å¤‡ä»½

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q1: æ— äººæœºæ— æ³•è¿æ¥MQTTï¼Ÿ
**A**: æ£€æŸ¥å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾1883ç«¯å£ï¼Œæ£€æŸ¥MQTTé…ç½®æ˜¯å¦å…è®¸å¤–éƒ¨è¿æ¥

### Q2: å‰ç«¯è®¿é—®æç¤ºWebSocketè¿æ¥å¤±è´¥ï¼Ÿ
**A**: æ£€æŸ¥Nginxé…ç½®çš„WebSocketä»£ç†ï¼Œç¡®ä¿Upgradeå¤´æ­£ç¡®è½¬å‘

### Q3: ç‚¹äº‘æ•°æ®ä¼ è¾“æ…¢ï¼Ÿ
**A**: è€ƒè™‘åœ¨æ— äººæœºç«¯å‹ç¼©æ•°æ®ï¼Œæˆ–ä½¿ç”¨äº‘æœåŠ¡å™¨æ›´é«˜å¸¦å®½å¥—é¤

### Q4: æœåŠ¡å™¨å†…å­˜ä¸è¶³ï¼Ÿ
**A**: å‡çº§æœåŠ¡å™¨é…ç½®ï¼Œæˆ–ä¼˜åŒ–ç‚¹äº‘ç´¯ç§¯ä¸Šé™

### Q5: å¦‚ä½•å®ç°å¤šæ— äººæœºç®¡ç†ï¼Ÿ
**A**: MQTTä½¿ç”¨topicåŒºåˆ†ä¸åŒæ— äººæœºï¼Œåç«¯ç»´æŠ¤æ— äººæœºIDæ˜ å°„

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [é˜¿é‡Œäº‘è½»é‡åº”ç”¨æœåŠ¡å™¨æ–‡æ¡£](https://help.aliyun.com/product/59601.html)
- [Nginxé…ç½®æŒ‡å—](https://nginx.org/en/docs/)
- [PM2è¿›ç¨‹ç®¡ç†](https://pm2.keymetrics.io/docs/usage/quick-start/)
- [Mosquitto MQTTæ–‡æ¡£](https://mosquitto.org/documentation/)
- [Let's Encryptå…è´¹è¯ä¹¦](https://letsencrypt.org/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2024-12-01
**é€‚ç”¨ç³»ç»Ÿç‰ˆæœ¬**: v3.2.1.1
